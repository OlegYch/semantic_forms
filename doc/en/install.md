[Installation de l'application générique `semantic_forms`](../en/install.md)
[Administration](administration.md)

# Installation of the `semantic_forms` generic application

## Prerequisites 
- Java JRE 8 (check with `java -version`)

## Obtaining the zipped application
The zipped application is available as a [github release](https://github.com/jmvanel/semantic_forms/releases).

## Runnning the zipped application
Download this zip on the server, unzip and type (on Linux or Mac):
```shell
cd semantic_forms_play-1.0-SNAPSHOT
nohup bin/semantic_forms_play -J-Xmx50M &
```

`nohup` starts the application so that it continues running after the user disconnects.
One can also simply run:
```
bin/semantic_forms_play -J-Xmx50M &
```
but then the application will be stopped when the user disconnects.

### On windows
**On windows** simply run:
```
bin\semantic_forms_play.bat -J-Xmx50M &
```
But there is a reported problem on Windows, related to the size of the classpath variable generated by the `semantic_forms_play.bat` script.
The message is:

```
The input line is too long.
The syntax of the command is incorrect.
```
This is probably corrected in Play! Framework 2.5 .
There is a workaround. Change the long line in `bin\semantic_forms_play.bat` with this one:
```
set "APP_CLASSPATH=%APP_LIB_DIR%..\conf\;%APP_LIB_DIR%*;"
```
See also:
http://stackoverflow.com/questions/21429234/play-framework-2-stage-task-on-windows-the-input-line-is-too-long

### URL of the main application page
The default port is 9000, so you can direct your browser to [http://localhost:9000](http://localhost:9000) .
The generic application is perfectly usable out of the box, see [User manual](https://github.com/jmvanel/semantic_forms/wiki/User_manual).
However, it is better to preload common RDF vocabularies and related form specifications and I18N translations, see below "Database manipulations".

#### Stopping the zipped distribution
`kill` the java application; its process ID is in the `RUNNING_PID` file.

## Database manipulations
It is better to preload common RDF vocabularies and related form specifications and I18N translations, for this run:
```shell
scripts/populateRDFCache.sh
```
**CAUTION: all scripts involving the database must be run when the web application is stopped.**

For more details, see: [preloading RDF content](../../scala/forms_play/README.md#preloading-rdf-content) .

To get all RDF data created by user "u:uu", run this:
```shell
scripts/graphdump.sh u:uu
```


## Settings when runnning the zipped distribution
You can change the default port (9000) to e.g. 9999 like this:

	nohup bin/semantic_forms_play -J-Xmx50M -Dhttp.port=9999 &

There is no need to be administrator.

You can set detailed loggin running like this:
```shell
PORT=9000
bin/semantic_forms_play -J-Xmx2000M -J-server -Dhttp.port=$PORT -Dlog4j.configurationFile=conf/log4j2.debug.properties
```

# Work with the `semantic_forms` distribution

## Scripts for Unix
Scripts are in the scripts/ directory. There are currently:

```
scripts/clone_implementation.sh
scripts/download-dbpedia.sh
scripts/dump.sh
scripts/graphdump.sh
scripts/graphload.sh
scripts/index_lucene.sh
scripts/load_dump_no_erase.sh
scripts/load_dump.sh
scripts/populateRDFCache.sh
scripts/populate_with_dbpedia.sh
scripts/start.sh
scripts/stop.sh
scripts/tdbsearch.sh
```

Of course, all the Jena command line tools are available, see:
https://jena.apache.org/documentation/tools/index.html

## Managing server update

If you want to frequently update a server with respect to source code from git, there is the script:
`$HOME/src/semantic_forms/scala/scripts/update_server.sh`

Several variables can be customized at script beginning (see next paragraph).

## Managing multi administrators site

Currently, all compiled stuff (target/ directories made by SBT) for `semantic_forms` amounts to 500 Mbytes. The unzipped `semantic_forms` distribution amounts to 120 Mbytes.
So it makes sense to share this among several administrators, each managing a different server on a different port.

So, for multiple administrators sharing usage: do this just once
- change DEPLOY variable in update_server.sh
- create a Linux group sf for sharing, and 2 shared directories:
```shell
sudo addgroup sf
groups
DEPLOY=/var/www/sf_deploy
sudo mkdir -p $DEPLOY
sudo chgrp sf $DEPLOY
sudo chmod g+rwx $DEPLOY

SFSRC=/var/www/sf_src
sudo mkdir -p $SFSRC
sudo chgrp sf $SFSRC
sudo chmod g+rwx $SFSRC

# for each administrator user add it to the group
sudo usermod -a -G sf adminuser1
```
- populate 2 shared directories the first time, as a user belonging to group sf:
```shell
cd $SFSRC
git clone https://github.com/jmvanel/semantic_forms.git
cd semantic_forms/scala
# change DEPLOY variable in update_server.sh to /var/www/sf_deploy
./scripts/update_server.sh
# clone SF unzipped directory
cd $DEPLOY
cd semantic_forms_play-2.1-SNAPSHOT
./scripts/clone_implementation.sh
cd ..
mv semantic_forms_cloned ${USER}_instance
# of course , you can have several instances, just rename the cloned directory as you want.
cd ${USER}_instance
cp scripts/start.sh .
echo customize start.sh ( PORT ,etc )
vi start.sh
echo customize instance specific message
vi messages.html
```

The stage is set for your instance!
Now to start the instance on the chosen port:
```shell
cd $DEPLOY/${USER}_instance
./start.sh
```
To stop the instance on the chosen port:
```shell
cd $DEPLOY/${USER}_instance
./scripts/stop.sh
```

## Setup a new instance with common vocab's, form specifications, translations, dbPedia mirroring and Lucene indexing
The scripts must be run in this order:
```
scripts/populate_with_dbpedia.sh
scripts/populateRDFCache.sh
scripts/index_lucene.sh
```

## Backup and recovery from backups

The scripts to launch are: `dump.sh, clone_implementation.sh, load_dump.sh, start.sh`.
For example, starting from an installed directory `semantic_forms_play-1.0-SNAPSHOT`, this script backs up the data, then clones the distribution, then loads the backup into the freshly cloned distribution:

```
scripts/dump.sh
scripts/clone_implementation.sh
cd ../semantic_forms_cloned
scripts/load_dump.sh ../semantic_forms_play-1.0-SNAPSHOT
scripts/start.sh
```
NOTE:
There is currently no way to back up specifically the user data, it is mixed with the cached data.
However, it is possible to to back up the data of a specific user; as it is in a named graph derived from its user URI .


